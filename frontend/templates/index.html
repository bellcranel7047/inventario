<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Inventario</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

<div class="container">
    <h1>Inventario</h1>

    <!-- FORMULARIO -->
    <form method="POST" action="/agregar">
        <input name="nombre" placeholder="Nombre" required>
        <input name="cantidad" type="number" placeholder="Cantidad" required>
        <input name="precio" type="number" step="0.01" placeholder="Precio" required>
        <button type="submit">Agregar</button>
    </form>

    <!-- TABLA -->
    <table>
        <thead>
            <tr>
                <th>Nombre</th>
                <th>Cantidad</th>
                <th>Precio</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
        {% for p in productos %}
            <tr>
                <td>{{ p["nombre"] }}</td>
                <td>{{ p["cantidad"] }}</td>
                <td>${{ p["precio"] }}</td>
                <td>
                    <!-- EDITAR -->
                    <button class="edit-btn" data-id="{{ p['id'] }}">‚úèÔ∏è</button>

                    <!-- ELIMINAR -->
                    <a href="/eliminar/{{ p['id'] }}">üóëÔ∏è</a>
                </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
</div>

<!-- MODAL EDITAR -->
<div id="modal" class="modal">
    <div class="modal-content">
        <h2>Editar producto</h2>

        <input type="hidden" id="edit-id">
        <input id="edit-nombre" placeholder="Nombre">
        <input id="edit-cantidad" type="number" placeholder="Cantidad">
        <input id="edit-precio" type="number" step="0.01" placeholder="Precio">

        <div class="modal-actions">
            <button id="guardar-btn">Guardar</button>
            <button class="cancel" id="cancelar-btn">Cancelar</button>
        </div>
    </div>
</div>

<!-- JAVASCRIPT -->
<script>
const API = "http://localhost:5000";

// ABRIR MODAL
document.querySelectorAll(".edit-btn").forEach(btn => {
    btn.addEventListener("click", () => {
        const id = btn.dataset.id;

        fetch(`${API}/productos/${id}`)
            .then(res => res.json())
            .then(p => {
                document.getElementById("edit-id").value = p.id;
                document.getElementById("edit-nombre").value = p.nombre;
                document.getElementById("edit-cantidad").value = p.cantidad;
                document.getElementById("edit-precio").value = p.precio;
                document.getElementById("modal").style.display = "flex";
            });
    });
});

// CERRAR MODAL
document.getElementById("cancelar-btn").addEventListener("click", () => {
    document.getElementById("modal").style.display = "none";
});

// GUARDAR CAMBIOS
document.getElementById("guardar-btn").addEventListener("click", () => {
    const id = document.getElementById("edit-id").value;

    fetch(`${API}/productos/${id}`, {
        method: "PUT",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
            nombre: document.getElementById("edit-nombre").value,
            cantidad: document.getElementById("edit-cantidad").value,
            precio: document.getElementById("edit-precio").value
        })
    }).then(() => location.reload());
});
</script>

</body>
</html>
